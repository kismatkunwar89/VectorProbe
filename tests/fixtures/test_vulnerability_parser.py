"""
Unit tests for vulnerability_parser.py

Run:
    pytest -q
"""

import json
from pathlib import Path

from src.parsers.vulnerability_parser import parse_searchsploit_json


def test_parse_searchsploit_json_fixture():
    """
    Ensure the parser loads exploit entries from a known fixture.
    """
    fixture_path = Path("tests/fixtures/searchsploit.json")
    raw = json.loads(fixture_path.read_text(encoding="utf-8"))

    exploits = parse_searchsploit_json(raw)

    # Basic checks
    assert isinstance(exploits, list)
    assert len(exploits) == 1

    e = exploits[0]
    assert e["title"] == "OpenSSH 7.2p2 - Username Enumeration"
    assert e["edb_id"] == "40136"
    assert e["platform"] == "linux"
    assert e["path"].endswith(".py")
    assert e["url"].startswith("https://")
